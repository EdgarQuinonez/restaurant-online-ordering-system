<div class="payment-container">
  <h2 class="text-xl font-semibold text-gray-900 mb-6">Información de Pago</h2>

  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-container text-center py-8">
      <p-progressSpinner
        styleClass="w-8 h-8"
        strokeWidth="4"
      ></p-progressSpinner>
      <p class="text-gray-600 mt-4">Configurando método de pago seguro...</p>
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="error-container mb-6">
      <p-message severity="error" [closable]="false" class="w-full">
        {{ error() }}
      </p-message>
      <div class="flex justify-center mt-4">
        <button
          pButton
          label="Reintentar"
          (click)="retryInitialization()"
          class="p-button-outlined p-button-secondary"
          icon="pi pi-refresh"
        ></button>
      </div>
    </div>
  }

  <!-- Payment Form -->
  @if (!loading() && !error()) {
    <form [formGroup]="paymentForm()" class="space-y-6">
      <!-- Card Holder Name -->
      <div class="flex flex-col gap-2">
        <label for="cardHolder" class="block text-sm font-medium text-gray-700">
          Nombre del Titular *
        </label>
        <input
          id="cardHolder"
          type="text"
          pInputText
          formControlName="cardHolder"
          placeholder="JUAN PEREZ GARCIA"
          class="w-full"
        />
        @if (isFieldInvalid("cardHolder")) {
          <p-message severity="error" size="small" variant="simple">
            {{ getFieldError("cardHolder") }}
          </p-message>
        }
      </div>

      <!-- Stripe Payment Element -->
      <div class="flex flex-col gap-2">
        <label class="block text-sm font-medium text-gray-700">
          Detalles de Pago *
        </label>
        <div #paymentElement class="stripe-payment-element w-full">
          <!-- Stripe Payment Element will be mounted here -->
        </div>
        @if (hasError()) {
          <p-message severity="error" size="small" variant="simple">
            {{ getErrorMessage() }}
          </p-message>
        }
        <small class="text-gray-500 text-xs mt-1">
          Los detalles de tu tarjeta se procesan de forma segura a través de
          Stripe. Aceptamos tarjetas de crédito y débito principales.
        </small>
      </div>

      <!-- Security Badge -->
      <div
        class="security-badge flex items-center justify-center gap-2 p-3 bg-gray-50 rounded-lg border border-gray-200"
      >
        <i class="pi pi-shield text-green-500"></i>
        <span class="text-sm text-gray-600">Pago 100% seguro y encriptado</span>
      </div>
    </form>
  }

  <!-- Navigation Buttons -->
  <div class="flex pt-6 justify-between">
    <p-button
      (onClick)="goBack()"
      label="Atrás"
      severity="secondary"
      icon="pi pi-arrow-left"
      [disabled]="loading()"
    />
    <p-button
      label="Realizar Pago"
      (onClick)="onContinue()"
      [disabled]="!formValid() || loading()"
      [loading]="loading()"
      icon="pi pi-lock"
      iconPos="right"
      [class]="!formValid() || loading() ? 'opacity-50 cursor-not-allowed' : ''"
    />
  </div>
</div>
